# Databases

There are currently five curated databases available on the Analytical Platform:

1.  [CREST](#crest)
2.  [HOCAS](#hocas)
3.  [NOMIS](#nomis)
4.  [TAR](#tar)
5.  [XHIBIT](#xhibit)

Information about these databases is given below.

## Access permissions

To access all curated databases on the Analytical Platform, you __must__ have completed the baseline personnel security standard (BPSS).

For each database, there are up to three different access levels:


Access level    | Description
----------------|-----------------
Basic           | Access to aggregated or derived tables only
Standard        | Access to individual--level data with all personal information removed, redacted or masked.
Full            | Access to individual--level data, including all personal information

### Data access requests

To request access to a curated database, you must submit a [data access request](https://forms.office.com/Pages/ResponsePage.aspx?id=KEeHxuZx_kGp4S6MNndq2BOEgSXQX71KliRRhdF6GWNUN0RVNDFaSjFPTVg1Q1pJWE8yUjFaSVdVSSQlQCN0PWcu).

The form requires you to provide the following information. You may not need to complete all fields depending on your responses.

Field                                   | Details
----------------------------------------|----------------------------------------
Name                                    |
Email address                           |
Approver name                           | The approver should be in your line management chain and should be at least a Band A.
Approver email address                  |
Which database do you require access to | CREST, HOCAS, NOMIS, TAR or XHIBIT.
What level of access do you require?    | Basic, Standard or Full.
Why do you require standard access?     | You should state why you require access to individual-level data.
Why do you require full access?         | You should state why you require access to individual-level data and data that contains personal information.


## CREST{#crest}

CREST is the Crown Court database (soon to be superseeded by [XHIBIT](#XHIBIT)) it holds data on cases going through or completed at the Crown Court. These are trial, sentence and appeal cases. We create and maintain a copy of the raw relational database system and also create calculated tables for analytical purposes. If you need access to this table you will need to submit a data access request with the level of access you want:

**AP Database Names:**
- `crest_v1`: The main database which holds the relational database and derived tables.
- `crest_lookups_v1`: A table of database lookups maintained by ASD which have useful categories and measures.

**Basic**:
Access to the derived tables (`flatfile` and `all_offence_disp`) used for most analytical and stats purposes as well as the full `crest_lookups_v1` database.

**Standard:**
Basic level access and access to the full database (`crest_v1`) (except for tables that hold personal identifiers such as names and addresses i.e. `crest_v1.subject`)

**Full:**
Access to everything in i.e. `crest_v1.*`

### Tables

```{bash clone crest repo, include=FALSE}
set -e

[ -z "${GITHUB_TOKEN}" ] && exit 0

git config --global user.name calumabarnett
git config --global user.email calum.barnett@digital.justice.gov.uk

if [ -d "_temp_" ]; then
  if [ -d "_temp_/crest" ]; then
    cd _temp_/crest
    git pull origin master
  else
    cd _temp_
    git clone https://${GITHUB_TOKEN}@github.com/moj-analytical-services/crest_engineering_draft.git crest
  fi
else
  mkdir _temp_
  cd _temp_
  git clone https://${GITHUB_TOKEN}@github.com/moj-analytical-services/crest_engineering_draft.git crest
fi
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(jsonlite)
library(data.table)
library(knitr)
table_name <- character()
table_description <- character()
for(file in list.files(path = '_temp_/crest/v1/meta_data/crest', full.names = TRUE)){
parsed_json <- fromJSON(file)
table_name <- append(table_name, parsed_json$name)
table_description <- append(table_description, parsed_json$description)
}
dt <- data.table('Table name' = table_name, 'Description' = table_description)
kable(dt)
```

## HOCAS{#hocas}

### Tables

```{bash clone crest repo, include=FALSE}
set -e

[ -z "${GITHUB_TOKEN}" ] && exit 0

git config --global user.name calumabarnett
git config --global user.email calum.barnett@digital.justice.gov.uk

if [ -d "_temp_" ]; then
  if [ -d "_temp_/hocas" ]; then
    cd _temp_/hocas
    git pull origin master
  else
    cd _temp_
    git clone https://${GITHUB_TOKEN}@github.com/moj-analytical-services/HOCAS.git crest
  fi
else
  mkdir _temp_
  cd _temp_
  git clone https://${GITHUB_TOKEN}@github.com/moj-analytical-services/HOCAS.git crest
fi
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(jsonlite)
library(data.table)
library(knitr)
table_name <- character()
table_description <- character()
for(file in list.files(path = '_temp_/HOCAS/meta_data/curated', full.names = TRUE)){
parsed_json <- fromJSON(file)
table_name <- append(table_name, parsed_json$name)
table_description <- append(table_description, parsed_json$description)
}
dt <- data.table('Table name' = table_name, 'Description' = table_description)
kable(dt)
```

## NOMIS{#nomis}

### Tables

```{bash clone crest repo, include=FALSE}
set -e

[ -z "${GITHUB_TOKEN}" ] && exit 0

git config --global user.name calumabarnett
git config --global user.email calum.barnett@digital.justice.gov.uk

if [ -d "_temp_" ]; then
  if [ -d "_temp_/nomis" ]; then
    cd _temp_/nomis
    git pull origin master
  else
    cd _temp_
    git clone https://${GITHUB_TOKEN}@github.com/moj-analytical-services/airflow_nomis_transform.git crest
  fi
else
  mkdir _temp_
  cd _temp_
  git clone https://${GITHUB_TOKEN}@github.com/moj-analytical-services/airflow_nomis_transform.git crest
fi
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(jsonlite)
library(data.table)
library(knitr)
table_name <- character()
table_description <- character()
for(file in list.files(path = '_temp_/airflow_nomis_transform/meta_data/curated', full.names = TRUE)){
parsed_json <- fromJSON(file)
table_name <- append(table_name, parsed_json$name)
table_description <- append(table_description, parsed_json$description)
}
dt <- data.table('Table name' = table_name, 'Description' = table_description)
kable(dt)
```

## TAR{#tar}

## XHIBIT{#xhibit}
